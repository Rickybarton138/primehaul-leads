{% extends "base.html" %}

{% block title %}Quote Submitted - PrimeHaul{% endblock %}

{% block head %}
<style>
  .success-hero {
    text-align: center;
    padding: 2rem 0 1.5rem;
  }
  .success-check {
    width: 80px;
    height: 80px;
    margin: 0 auto 1.25rem;
    background: var(--accent);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 0 40px rgba(46,229,157,0.25);
    animation: popIn 0.4s ease-out;
  }
  @keyframes popIn {
    0% { transform: scale(0); opacity: 0; }
    70% { transform: scale(1.1); }
    100% { transform: scale(1); opacity: 1; }
  }
  .success-check svg {
    width: 40px;
    height: 40px;
  }
  .success-title {
    font-size: 1.5rem;
    font-weight: 700;
    letter-spacing: -0.02em;
    margin-bottom: 0.25rem;
  }
  .success-subtitle {
    color: var(--text-muted);
    font-size: 0.95rem;
  }

  .next-steps {
    margin-top: 1.5rem;
  }
  .step-row {
    display: flex;
    align-items: flex-start;
    gap: 0.85rem;
    padding: 0.85rem 0;
  }
  .step-row + .step-row {
    border-top: 1px solid rgba(255,255,255,0.05);
  }
  .step-num {
    flex-shrink: 0;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--accent-glow);
    border: 1px solid rgba(46,229,157,0.2);
    color: var(--accent);
    font-weight: 700;
    font-size: 0.85rem;
    border-radius: 50%;
  }
  .step-text {
    font-size: 0.9rem;
    line-height: 1.5;
    padding-top: 0.15rem;
  }
  .step-text strong {
    display: block;
    font-size: 0.92rem;
    margin-bottom: 0.1rem;
  }
  .step-detail {
    color: var(--text-muted);
    font-size: 0.82rem;
  }

  .move-summary {
    margin-top: 1.5rem;
  }
  .summary-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.55rem 0;
    font-size: 0.88rem;
  }
  .summary-row + .summary-row {
    border-top: 1px solid rgba(255,255,255,0.05);
  }
  .summary-label { color: var(--text-muted); }
  .summary-value { font-weight: 600; }
  .summary-value.accent { color: var(--accent); }

  .route-arrow {
    text-align: center;
    padding: 0.5rem 0;
    color: var(--accent);
    font-size: 1.1rem;
  }

  /* Referral section */
  .referral-section {
    margin-top: 1.5rem;
    border: 1px solid rgba(46,229,157,0.12);
    background: rgba(46,229,157,0.03);
  }
  .referral-prompt {
    font-size: 0.9rem;
    color: var(--text-muted);
    margin-bottom: 1rem;
  }
  .share-whatsapp-big {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.6rem;
    margin-bottom: 0.75rem;
  }
  .share-whatsapp-big svg { width: 20px; height: 20px; }
  .share-buttons-row {
    display: flex;
    gap: 0.5rem;
  }
  .share-btn-sm {
    flex: 1;
    text-align: center;
    padding: 0.55rem 0.5rem;
    border-radius: var(--radius-sm);
    font-size: 0.8rem;
    font-weight: 500;
    color: var(--text-muted);
    background: rgba(255,255,255,0.04);
    border: 1px solid var(--glass-border);
    cursor: pointer;
    text-decoration: none;
    transition: background 0.15s;
  }
  .share-btn-sm:hover {
    background: rgba(255,255,255,0.08);
    color: var(--text);
  }
  .share-btn-sm.copied {
    background: var(--accent-glow);
    border-color: var(--accent);
    color: var(--accent);
  }
</style>
{% endblock %}

{% block content %}
<!-- Success hero -->
<div class="success-hero">
  <div class="success-check">
    <svg viewBox="0 0 24 24" fill="none" stroke="#0b0b0c" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
      <polyline points="20 6 9 17 4 12"></polyline>
    </svg>
  </div>
  <h1 class="success-title">Quote request submitted!</h1>
  <p class="success-subtitle">You are all set. Here is what happens next.</p>
</div>

<!-- What happens next -->
<div class="card next-steps">
  <div class="card-label">What happens next?</div>

  <div class="step-row">
    <div class="step-num">1</div>
    <div class="step-text">
      <strong>Your request is sent out</strong>
      <span class="step-detail">Local removal companies in your area will receive your move details and inventory.</span>
    </div>
  </div>

  <div class="step-row">
    <div class="step-num">2</div>
    <div class="step-text">
      <strong>Companies review and quote</strong>
      <span class="step-detail">You will be contacted with firm, no-obligation quotes within 24 hours.</span>
    </div>
  </div>

  <div class="step-row">
    <div class="step-num">3</div>
    <div class="step-text">
      <strong>Compare and choose</strong>
      <span class="step-detail">Compare quotes, check reviews, and choose the company that suits you best.</span>
    </div>
  </div>
</div>

<!-- Move summary -->
<div class="card move-summary">
  <div class="card-label">Your move summary</div>

  {% set pickup = lead.pickup or {} %}
  {% set dropoff = lead.dropoff or {} %}

  {% if pickup.city or pickup.postcode %}
  <div class="summary-row">
    <span class="summary-label">Collection</span>
    <span class="summary-value">{{ pickup.city or pickup.postcode or 'N/A' }}</span>
  </div>
  {% endif %}

  {% if dropoff.city or dropoff.postcode %}
  <div class="route-arrow">&darr;</div>
  <div class="summary-row">
    <span class="summary-label">Delivery</span>
    <span class="summary-value">{{ dropoff.city or dropoff.postcode or 'N/A' }}</span>
  </div>
  {% endif %}

  {% if lead.move_date %}
  <div class="summary-row">
    <span class="summary-label">Moving date</span>
    <span class="summary-value">{{ lead.move_date.strftime('%d %B %Y') if lead.move_date else 'Flexible' }}</span>
  </div>
  {% endif %}

  {% if lead.total_items %}
  <div class="summary-row">
    <span class="summary-label">Total items</span>
    <span class="summary-value">{{ lead.total_items }}</span>
  </div>
  {% endif %}

  {% if lead.total_cbm %}
  <div class="summary-row">
    <span class="summary-label">Total volume</span>
    <span class="summary-value">{{ "%.1f"|format(lead.total_cbm) }} m&sup3;</span>
  </div>
  {% endif %}

  {% if lead.estimate_low and lead.estimate_high %}
  <div class="summary-row">
    <span class="summary-label">Estimated cost</span>
    <span class="summary-value accent">&pound;{{ lead.estimate_low|int }} &ndash; &pound;{{ lead.estimate_high|int }}</span>
  </div>
  {% endif %}
</div>

<!-- Know someone moving? -->
<div class="card referral-section">
  <div class="card-label">Know someone moving?</div>
  <p class="referral-prompt">Share this free tool with friends or family who are planning a move</p>

  <a href="#" class="btn btn-primary share-whatsapp-big" onclick="shareWhatsAppDirect(event)">
    <svg viewBox="0 0 24 24" fill="currentColor" style="width:20px;height:20px"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347z"/><path d="M12 0C5.373 0 0 5.373 0 12c0 2.625.846 5.059 2.284 7.034L.789 23.492a.5.5 0 00.611.611l4.458-1.495A11.952 11.952 0 0012 24c6.627 0 12-5.373 12-12S18.627 0 12 0zm0 22c-2.357 0-4.542-.804-6.275-2.152l-.44-.352-3.083 1.034 1.034-3.083-.352-.44A9.96 9.96 0 012 12C2 6.486 6.486 2 12 2s10 4.486 10 10-4.486 10-10 10z"/></svg>
    Send to a friend on WhatsApp
  </a>

  <div class="share-buttons-row">
    <a href="#" class="share-btn-sm" onclick="shareFacebook(event)">Facebook</a>
    <a href="#" class="share-btn-sm" onclick="shareX(event)">X</a>
    <button class="share-btn-sm" onclick="copyShareLink(event)">Copy Link</button>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
(function() {
  var shareUrl = '{{ request.base_url }}share/{{ share_token }}';
  var shareLink = shareUrl + '?ref={{ ref_code }}';
  {% if lead.estimate_low and lead.estimate_high %}
  var estimateText = '\u00a3{{ lead.estimate_low|int }} - \u00a3{{ lead.estimate_high|int }}';
  var whatsappMsg = 'Just got my free AI moving quote - ' + estimateText + '! Took 5 mins. Try it: ' + shareLink;
  {% else %}
  var whatsappMsg = 'I just used this free AI tool for a moving quote. Really impressive! Try it: ' + shareLink;
  {% endif %}
  var whatsappDirectMsg = 'Hey! I just used this free AI tool to get a moving quote. Took 5 minutes and it was surprisingly accurate. You should try it for your move: ' + shareLink;
  var twitterMsg = whatsappMsg;

  window.shareWhatsAppDirect = function(e) {
    e.preventDefault();
    window.open('https://wa.me/?text=' + encodeURIComponent(whatsappDirectMsg), '_blank', 'noopener');
  };
  window.shareFacebook = function(e) {
    e.preventDefault();
    window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(shareLink), '_blank', 'width=600,height=400,noopener');
  };
  window.shareX = function(e) {
    e.preventDefault();
    window.open('https://twitter.com/intent/tweet?text=' + encodeURIComponent(twitterMsg), '_blank', 'width=600,height=400,noopener');
  };
  window.copyShareLink = function(e) {
    e.preventDefault();
    var btn = e.currentTarget;
    navigator.clipboard.writeText(shareLink).then(function() {
      btn.classList.add('copied');
      var orig = btn.textContent;
      btn.textContent = 'Copied!';
      setTimeout(function() { btn.classList.remove('copied'); btn.textContent = orig; }, 2000);
    });
  };
})();
</script>
{% endblock %}
